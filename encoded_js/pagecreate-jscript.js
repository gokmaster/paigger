function showHeadingControls(){$("#headingButtonsDiv").slideToggle()}function showlinkdiv(){$(".controlsBox").hide(),$("#linkbox").slideToggle()}function showimagediv(){$(".controlsBox").hide(),$("#imagebox").slideToggle()}function showVideoDiv(){$(".controlsBox").hide(),$("#videobox").slideToggle()}function showAdvanced(){$("#advancedControlsDiv").slideToggle()}function addlink(){restoreSelection(selectedRange),document.getElementById("textarea").focus();var e=document.getElementById("linktext").value,t=document.getElementById("linkurl").value,e=removeHTMLtags(e),t=removeHTMLtags(t);null==e||""==e||null==t||""==t?alert("Text and url is required."):pasteHtmlAtCaret("<a href="+t+" target=_blank>"+e+"</a> &nbsp")}function insertVideo(){restoreSelection(selectedRange),document.getElementById("textarea").focus();var e=youtube_parser(document.getElementById("videoURL").value);0!=e?pasteHtmlAtCaret("<div class='page_video_container' contenteditable='false' ><iframe class='page_video' src='https://www.youtube.com/embed/"+e+"'></iframe></div>"):alert("Please enter a valid Youtube URL")}function removePageVideo(e){var t=$(e).parent();$(t).remove()}function bold(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("bold"),isButtonActive()}function italic(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("italic"),isButtonActive()}function underline(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("underline"),isButtonActive()}function bulletedList(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("insertUnorderedList"),isButtonActive()}function orderedList(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("insertOrderedList"),isButtonActive()}function strikethrough(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("strikeThrough"),isButtonActive()}function horizontalRule(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("insertHorizontalRule"),isButtonActive()}function para(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("insertParagraph"),closeThis($("#btnParagraph")),$("#btnShowHeadingControls").val(e)}function heading(e,t){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("formatBlock",!1,"<"+e+">"),closeThis($("#btnParagraph")),$("#btnShowHeadingControls").val(t)}function isButtonActive(){var e=["bold","italic","underline","insertUnorderedList","insertOrderedList","strikeThrough","insertHorizontalRule","justifyRight","justifyLeft","justifyCenter","justifyFull","outdent","indent"],t=["#btnBold","#btnItalic","#btnUnderline","#btnBulletedList","#btnOrderedList","#btnStrikethrough","insertHorizontalRule","#btnJustifyRight","#btnJustifyLeft","#btnJustifyCenter","#btnJustify","#btnOutdent","#btnIndent"];for(max_count=e.length,i=0;i<max_count;i++)document.queryCommandState(e[i])?$(t[i]).addClass("activeButton"):$(t[i]).removeClass("activeButton")}function selected_blockLevelElement(e){$("#btnShowHeadingControls").removeClass("activeButton"),$("#btnCode").removeClass("activeButton"),$("#btnQuote").removeClass("activeButton");for(var t,n=e.target,o="Paragraph";"DIV"!=n.nodeName.toUpperCase();)"H1"==n.nodeName.toUpperCase()?o="Heading 1":"H2"==n.nodeName.toUpperCase()?o="Heading 2":"H3"==n.nodeName.toUpperCase()?o="Heading 3":"H4"==n.nodeName.toUpperCase()?o="Heading 4":"H5"==n.nodeName.toUpperCase()?o="Heading 5":"H6"==n.nodeName.toUpperCase()?o="Heading 6":"PRE"==n.nodeName.toUpperCase()?$("#btnCode").addClass("activeButton"):$(n).hasClass("styled_quote")&&$("#btnQuote").addClass("activeButton"),$("#btnShowHeadingControls").addClass("activeButton"),$("#btnShowHeadingControls").val(o),t=n.nodeName.toUpperCase(),n=n.parentNode;return t}function removeHTMLtags(e){return $($.parseHTML(e)).text()}function youtube_parser(e){if(e.match(/(youtube.com)/))var t="v=",n=1;else{if(!e.match(/(youtu.be)/))return!1;var t="/",n=3}return e.split(t)[n].replace(/(&)+(.*)/,"")}function getSelectionContainerElement(){var e,t,n;return document.selection&&document.selection.createRange?(e=document.selection.createRange()).parentElement():window.getSelection&&(t=window.getSelection(),t.getRangeAt?t.rangeCount>0&&(e=t.getRangeAt(0)):((e=document.createRange()).setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset),e.collapsed!==t.isCollapsed&&(e.setStart(t.focusNode,t.focusOffset),e.setEnd(t.anchorNode,t.anchorOffset))),e)?(n=e.commonAncestorContainer,3===n.nodeType?n.parentNode:n):void 0}function saveSelection(){return window.getSelection?(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount?sel.getRangeAt(0):void 0):window.selection&&window.selection.createRange?window.selection.createRange():selectedRange}function restoreSelection(e){e&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(e)):window.selection&&e.select&&e.select())}function pasteHtmlAtCaret(e){var t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var a,i,c=document.createDocumentFragment();a=o.firstChild;)i=c.appendChild(a);n.insertNode(c),i&&((n=n.cloneRange()).setStartAfter(i),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}function removeBlockFormatting(e){$(e).unwrap(),$(e).remove()}function remove_nbsp_from_p(){$.ajaxSetup({async:!1}),$("#textarea p").each(function(){var e=$(this);e.html(e.html().replace(/&nbsp;/g,""))}),$.ajaxSetup({async:!0})}function remove_empty_lastchild_p(){var e=$("#textarea").children().last(),t=$.trim(e.html());e.is("p")&&0==t.length&&e.remove()}var selectedRange;$(document).ready(function(){$("#textarea > p:last-child").length>0&&$("#textarea > p:last-child").focus()}),$("#textarea").keyup(function(){selectedRange=saveSelection()}),$("#textarea").mouseup(function(){selectedRange=saveSelection()}),$(document).mouseup(function(e){click_outside_to_hide($("#headingButtonsDiv"),e)}),$(document).on("click","#textarea .page_video_container",function(){$(this).find(".btnClose").length||$(this).append("<input type=image onclick=removePageVideo(this) src=image/icon/close.gif alt='Remove video' title='Remove video' class=btnClose >")}),$(document).mouseup(function(e){$(".page_video_container").find(".btnClose").length&&click_outside_to_remove($(".page_video_container"),$(".btnClose"),e)}),$("#btnJustifyLeft").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("justifyLeft"),isButtonActive()}),$("#btnJustifyCenter").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("justifyCenter"),isButtonActive()}),$("#btnJustifyRight").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("justifyRight"),isButtonActive()}),$("#btnJustify").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("justifyFull"),isButtonActive()}),$("#btnOutdent").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("outdent"),isButtonActive()}),$("#btnIndent").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),document.execCommand("indent"),isButtonActive()}),$("#btnQuote").click(function(e){if(restoreSelection(selectedRange),document.getElementById("textarea").focus(),"BLOCKQUOTE"==getSelectionContainerElement().nodeName.toUpperCase())document.execCommand("formatBlock",!1,"<p>"),$("#btnQuote").removeClass("activeButton");else{document.execCommand("formatBlock",!1,"<blockquote>");var t=window.getSelection().focusNode.parentNode;$(t).addClass("styled_quote"),$("#btnQuote").addClass("activeButton")}}),$(document).on("click","#textarea .styled_quote",function(){var e=$(this);$(e).find(".btnCloseLeft").length||$(e).append("<input type=image onclick=removeBlockFormatting(this) src=image/icon/remove.jpg alt='Remove blockquote-formatting' title='Remove blockquote-formatting' class=btnCloseLeft >")}),$(document).mouseup(function(e){$("blockquote").find(".btnCloseLeft").length&&click_outside_to_remove($("blockquote"),$(".btnCloseLeft"),e)}),$("#btnCode").click(function(e){restoreSelection(selectedRange),document.getElementById("textarea").focus(),"PRE"==getSelectionContainerElement().nodeName.toUpperCase()?(document.execCommand("formatBlock",!1,"<p>"),$("#btnCode").removeClass("activeButton")):(document.execCommand("formatBlock",!1,"<pre>"),$("#btnCode").addClass("activeButton"))}),$(document).on("click","#textarea pre",function(){var e=$(this);$(e).find(".btnCloseLeft").length||$(e).append("<input type=image onclick=removeBlockFormatting(this) src=image/icon/remove.jpg alt='Remove code-formatting' title='Remove code-formatting' class=btnCloseLeft >")}),$(document).mouseup(function(e){$("pre").find(".btnCloseLeft").length&&click_outside_to_remove($("pre"),$(".btnCloseLeft"),e)}),$("#textarea").mouseup(function(e){isButtonActive(),selected_blockLevelElement(e)}),$("#textarea").keyup(function(e){isButtonActive()}),$("#textarea").on("keydown",function(e){if(window.getSelection&&8==e.which){var t=window.getSelection();if(!t.isCollapsed||!t.rangeCount)return;var n=t.getRangeAt(t.rangeCount-1);if(3==n.commonAncestorContainer.nodeType&&n.startOffset>0)return;var o=document.createRange();if(t.anchorNode!=this)o.selectNodeContents(this),o.setEndBefore(t.anchorNode);else{if(!(t.anchorOffset>0))return;o.setEnd(this,t.anchorOffset)}o.setStart(this,o.endOffset-1);var a=o.cloneContents().lastChild;a&&"false"==a.contentEditable&&(o.deleteContents(),e.preventDefault())}}),$("#textarea").mouseup(function(e){var t=$("#textarea").children().last(),n=$.trim(t.html());(!t.is("p")||n.length>6)&&$("#textarea").append("<p>&nbsp</p>")}),$("#textarea").on("mousedown",function(){$("#txtEnterContentHere").length>0&&$("#txtEnterContentHere").remove()}),$("#textarea").on("keydown",function(){$("#txtEnterContentHere").length>0&&$("#txtEnterContentHere").remove()});